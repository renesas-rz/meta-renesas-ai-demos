From 72741aae81f7b6a06cc1e6a841fcd9eb009339d9 Mon Sep 17 00:00:00 2001
From: Gareth Williams <gareth.williams.jx@renesas.com>
Date: Tue, 2 Nov 2021 15:26:59 +0000
Subject: [PATCH] Enable RZ/G2L Qt SDK builds

Signed-off-by: Gareth Williams <gareth.williams.jx@renesas.com>
---
 .../qt5-layer/images/core-image-qt-sdk.bb          | 30 ++++++++++++++++++++++
 1 file changed, 30 insertions(+)
 create mode 100644 dynamic-layers/qt5-layer/images/core-image-qt-sdk.bb

diff --git a/dynamic-layers/qt5-layer/images/core-image-qt-sdk.bb b/dynamic-layers/qt5-layer/images/core-image-qt-sdk.bb
new file mode 100644
index 0000000..706e3a8
--- /dev/null
+++ b/dynamic-layers/qt5-layer/images/core-image-qt-sdk.bb
@@ -0,0 +1,30 @@
+include core-image-qt.bb
+inherit populate_sdk_qt5_base
+
+### For cross-compile Qt ###
+TOOLCHAIN_HOST_TASK_append = ' nativesdk-qtbase-tools '
+
+# Create pri file to prevent below warning when running qmake
+#   "...usr/lib/qt5/mkspecs/oe-device-extra.pri: No such file or directory"
+fakeroot append_qt () {
+       # Generate oe-device-extra.pri
+       if [ -d ${SDK_OUTPUT}/${SDKPATH}/sysroots/${TARGET_SYS}/${libdir}/${QT_DIR_NAME}/mkspecs ] &&
+          [ ! -f ${SDK_OUTPUT}/${SDKPATH}/sysroots/${TARGET_SYS}/${libdir}/${QT_DIR_NAME}/mkspecs/oe-device-extra.pri ]
+       then
+               touch ${SDK_OUTPUT}/${SDKPATH}/sysroots/${TARGET_SYS}/${libdir}/${QT_DIR_NAME}/mkspecs/oe-device-extra.pri
+       fi
+}
+SDK_POSTPROCESS_COMMAND_prepend = " append_qt;"
+
+
+### For self-compile Qt ###
+IMAGE_INSTALL_append = ' packagegroup-qt5-toolchain-target '
+
+setup_qt_env () {
+        if [ ! -e ${IMAGE_ROOTFS}/${sysconfdir}/profile.d/setup_qt_env ]
+        then
+                echo 'export PATH=$PATH:/usr/bin/qt5' > ${IMAGE_ROOTFS}${sysconfdir}/profile.d/setup_qt_env
+                echo 'export INCLUDEPATH=$INCLUDEPATH:/usr/include/qt5' >> ${IMAGE_ROOTFS}${sysconfdir}/profile.d/setup_qt_env
+        fi
+}
+ROOTFS_POSTPROCESS_COMMAND += 'setup_qt_env;'
-- 
2.7.4

